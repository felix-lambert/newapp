/////////////////////////////////////////////////////////////////
// MODULE DEPENDENCIES //////////////////////////////////////////
/////////////////////////////////////////////////////////////////
var http       = require('http');
var express    = require('express');
var mongoose   = require('mongoose');
var config     = require('./backend/db/database');
var multipart  = require('connect-multiparty');
var chalk      = require('chalk');
var logSymbols = require('log-symbols');

console.log(logSymbols.info, chalk.blue('Launching dependencies ... please wait.'));

/////////////////////////////////////////////////////////////////
// CREATE AND CONFIG SERVER /////////////////////////////////////
/////////////////////////////////////////////////////////////////
var app = module.exports = express();

app.use(multipart({
  uploadDir: config.tmp
}));

/////////////////////////////////////////////////////////////////
// CONNECT TO DATABASE //////////////////////////////////////////
/////////////////////////////////////////////////////////////////
require('./backend/db/mongo');

/////////////////////////////////////////////////////////////////
// CONFIG DATA MODELS ///////////////////////////////////////////
/////////////////////////////////////////////////////////////////
console.log('check the models...');
require('./backend/models/models')(mongoose);
console.log(logSymbols.success, chalk.green('done'));

/////////////////////////////////////////////////////////////////
// CONFIGURE APPLICATION ////////////////////////////////////////
/////////////////////////////////////////////////////////////////
console.log('check the config...');
require('./backend/config/config')(app, express, config);
console.log(logSymbols.success, chalk.green('done'));

/////////////////////////////////////////////////////////////////
// PASSPORT AUTH STRATEGY ///////////////////////////////////////
/////////////////////////////////////////////////////////////////
console.log('check passportStrategy...');
require('./backend/authentification/passportStrategy.js')(app);
console.log(logSymbols.success, chalk.green('done'));

/////////////////////////////////////////////////////////////////
// ROUTES ///////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
console.log('check routes...');
require('./backend/routes/routes.js')(app);
console.log(logSymbols.success, chalk.green('done'));

/////////////////////////////////////////////////////////////////
// WEB SERVER /////////////////////////////////////
/////////////////////////////////////////////////////////////////
var server = http.createServer(app);

/////////////////////////////////////////////////////////////////
// SOCKET SERVER ////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
var chatServer = require('./backend/chatServer/chatServer')(server);

app.set('port', process.env.PORT || 3000);

/////////////////////////////////////////////////////////////////
// START THE SERVER /////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
server.listen(app.get('port'), function() {
  'use strict';
  console.log(logSymbols.success, chalk.green('Express server listening on port ' + app.get('port')));
});
